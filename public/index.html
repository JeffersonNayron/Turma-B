<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Revezamento Turma B</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    .status {
      font-size: 1.5rem;
    }
    td input[type="time"] {
      width: 100px;
    }
  </style>
</head>
<body class="p-4">

  <div class="container">
    <h1 class="mb-4">Revezamento Turma B</h1>

    <table class="table table-bordered text-center align-middle">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Hora In칤cio</th>
          <th>Hora Fim</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tabela">
        <!-- Exemplo de linha com dados din칙micos -->
        <!-- Essas linhas ser칚o geradas dinamicamente no servidor -->
        <tr>
          <td>Jefferson</td>
          <td class="hora_inicio" data-id="1">10:30</td>
          <td class="hora_fim" data-id="1">11:45</td>
          <td class="status">游릭</td>
        </tr>
        <tr>
          <td>Maria</td>
          <td class="hora_inicio" data-id="2">11:00</td>
          <td class="hora_fim" data-id="2">12:15</td>
          <td class="status">游댮</td>
        </tr>
        <!-- Adicione mais conforme necess치rio -->
      </tbody>
    </table>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      function ativarEdicao(selector, campo) {
        document.querySelectorAll(selector).forEach(el => {
          el.addEventListener('click', () => {
            const id = el.dataset.id;
            const valorAtual = el.textContent.trim();

            const input = document.createElement('input');
            input.type = 'time';
            input.value = valorAtual !== '-' ? valorAtual : '';
            input.classList.add('form-control');

            el.innerHTML = '';
            el.appendChild(input);
            input.focus();

            input.addEventListener('blur', () => salvar(input.value, id, campo, el));
            input.addEventListener('keydown', e => {
              if (e.key === 'Enter') {
                e.preventDefault();
                input.blur();
              }
            });
          });
        });
      }

      function salvar(valor, id, campo, tdElement) {
        const linha = tdElement.parentElement;
        const inicioEl = linha.querySelector('.hora_inicio');
        const fimEl = linha.querySelector('.hora_fim');
        const idPessoa = tdElement.dataset.id;

        const hora_inicio = (campo === 'hora_inicio') ? valor : inicioEl.textContent.trim();
        const hora_fim = (campo === 'hora_fim') ? valor : fimEl.textContent.trim();

        fetch('/editarHorario', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ id: idPessoa, hora_inicio, hora_fim })
        }).then(res => {
          if (!res.ok) throw new Error('Erro ao salvar');
          return res.json();
        }).then(data => {
          inicioEl.textContent = data.hora_inicio || '-';
          fimEl.textContent = data.hora_fim || '-';
          linha.querySelector('.status').textContent = data.status;
        }).catch(err => {
          alert('Erro ao salvar hor치rio');
          console.error(err);
        });
      }

      ativarEdicao('.hora_inicio', 'hora_inicio');
      ativarEdicao('.hora_fim', 'hora_fim');
    });
  </script>
</body>
</html>
